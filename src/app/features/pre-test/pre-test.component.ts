import { Component, signal } from '@angular/core';
import { CommonModule } from '@angular/common';
import { FormsModule } from '@angular/forms';

interface Question {
  id: number;
  text: string;
  options: string[];
  selectedOption?: string;
  correctOption: string; // The correct answer text
}

@Component({
  selector: 'app-pre-test',
  standalone: true,
  imports: [CommonModule, FormsModule],
  templateUrl: './pre-test.component.html',
  styles: [`
    .exam-container {
      padding: 2rem;
      direction: rtl;
      font-family: 'Noto Kufi Arabic', Arial, sans-serif;
      color: #1a1a1a;
      max-width: 900px;
      margin: 0 auto;
    }
    .instruction-card {
      background: #f9f9f9;
      border: 1px solid #ddd;
      border-radius: 8px;
      padding: 2rem;
      text-align: center;
      box-shadow: 0 4px 6px rgba(0,0,0,0.05);
    }
    .question-card {
      background: #fff;
      border: 1px solid #eee;
      border-radius: 8px;
      padding: 1.5rem;
      margin-bottom: 1.5rem;
      box-shadow: 0 2px 4px rgba(0,0,0,0.03);
    }
    .option-row {
      display: flex;
      align-items: center;
      gap: 10px;
      margin: 10px 0;
      padding: 10px;
      border-radius: 4px;
      transition: background 0.2s;
      cursor: pointer;
    }
    .option-row:hover {
      background: #f0f8ff;
    }
    .btn-start {
      background: #6b4226;
      color: white;
      padding: 12px 32px;
      border-radius: 4px;
      font-weight: bold;
      border: none;
      cursor: pointer;
      font-size: 1.1rem;
    }
    h2 { font-weight: 800; margin-bottom: 1rem; }
    h3 { font-weight: bold; margin-bottom: 1.5rem; color: #444; }
    .score-display {
      font-size: 2rem;
      color: #27ae60;
      font-weight: bold;
      margin: 1rem 0;
    }
  `]
})
export class PreTestComponent {
  step = signal<'intro' | 'exam' | 'result'>('intro');
  score = signal<number>(0);
  totalQuestions = signal<number>(0);

  questions = signal<Question[]>([
    {
      id: 1,
      text: 'يقصد بمفهوم التصميم الفني أنه:',
      options: [
        'أ. عملية عشوائية لرسم العناصر الفنية',
        'ب. تنظيم وتوظيف عناصر الفن لتحقيق الجمال فقط',
        'ج. تنظيم وتوظيف عناصر الفن وفق أسس جمالية لإنتاج عمل متكامل',
        'د. استخدام الألوان والخطوط دون تخطيط مسبق'
      ],
      correctOption: 'ج. تنظيم وتوظيف عناصر الفن وفق أسس جمالية لإنتاج عمل متكامل'
    },
    {
      id: 2,
      text: 'من أهداف التصميم الفني:',
      options: [
        'أ. تحقيق الجمال فقط دون وظيفة',
        'ب. الدمج بين الجمال والوظيفة',
        'ج. التركيز على اللون دون باقي العناصر',
        'د. إلغاء دور المتلقي في العمل الفني'
      ],
      correctOption: 'ب. الدمج بين الجمال والوظيفة'
    },
    {
      id: 3,
      text: 'أي مما يلي يُعد من عناصر التصميم الأساسية؟',
      options: [
        'أ. التدرج',
        'ب. النقطة',
        'ج. التوازن',
        'د. التوكيد'
      ],
      correctOption: 'ب. النقطة'
    },
    {
      id: 4,
      text: 'النقطة في التصميم تستخدم أساساً في:',
      options: [
        'أ. إحداث الإيقاع فقط',
        'ب. بناء التكوين الفني والتحكم في الاتجاه',
        'ج. إلغاء المساحة',
        'د. تحقيق الوحدة دون تنوع'
      ],
      correctOption: 'ب. بناء التكوين الفني والتحكم في الاتجاه'
    },
    {
      id: 5,
      text: 'أي من الآتي يُعد نوعاً من الخطوط؟',
      options: [
        'أ. خطوط دائرية',
        'ب. خطوط متوازنة',
        'ج. خطوط منحنية',
        'د. خطوط متناظرة'
      ],
      correctOption: 'ج. خطوط منحنية'
    },
    {
      id: 6,
      text: 'الشكل في التصميم يمكن أن يكون:',
      options: [
        'أ. هندسي فقط',
        'ب. طبيعي فقط',
        'ج. رقمي فقط',
        'د. هندسي أو طبيعي أو رقمي'
      ],
      correctOption: 'د. هندسي أو طبيعي أو رقمي'
    },
    {
      id: 7,
      text: 'يقصد بالحجم في التصميم:',
      options: [
        'أ. لون الشكل',
        'ب. مساحة الشكل فقط',
        'ج. الأبعاد الثلاثية للشكل',
        'د. نوع الخط المستخدم'
      ],
      correctOption: 'ج. الأبعاد الثلاثية للشكل'
    },
    {
      id: 8,
      text: 'الملمس الرقمي في التصميم يتم تحقيقه من خلال:',
      options: [
        'أ. الخامات الطبيعية فقط',
        'ب. الإضاءة الطبيعية',
        'ج. المؤثرات الرقمية داخل التصميم',
        'د. الورق والألوان اليدوية'
      ],
      correctOption: 'ج. المؤثرات الرقمية داخل التصميم'
    },
    {
      id: 9,
      text: 'أي مما يلي يُعد من أنواع الألوان؟',
      options: [
        'أ. الألوان المتوازنة',
        'ب. الألوان الساخنة والباردة',
        'ج. الألوان الانسجامية',
        'د. الألوان التركيزية'
      ],
      correctOption: 'ب. الألوان الساخنة والباردة'
    },
    {
      id: 10,
      text: 'يقصد بالتكرار في التصميم:',
      options: [
        'أ. استخدام عنصر واحد مرة واحدة',
        'ب. توزيع العناصر عشوائياً',
        'ج. إعادة استخدام العناصر لتحقيق الإيقاع',
        'د. تكبير حجم العناصر فقط'
      ],
      correctOption: 'ج. إعادة استخدام العناصر لتحقيق الإيقاع'
    },
    {
      id: 11,
      text: 'التدرج في التصميم يعتمد على:',
      options: [
        'أ. التناقض بين العناصر',
        'ب. الانتقال التدريجي بين الأحجام أو الألوان',
        'ج. التوازن المتماثل',
        'د. التكرار العشوائي'
      ],
      correctOption: 'ب. الانتقال التدريجي بين الأحجام أو الألوان'
    },
    {
      id: 12,
      text: 'التنوع في التصميم يهدف إلى:',
      options: [
        'أ. إحداث الملل البصري',
        'ب. إلغاء الوحدة',
        'ج. كسر الرتابة وتحقيق الجذب',
        'د. تقليل عدد العناصر'
      ],
      correctOption: 'ج. كسر الرتابة وتحقيق الجذب'
    },
    {
      id: 13,
      text: 'التوازن في التصميم يعني:',
      options: [
        'أ. تماثل الألوان فقط',
        'ب. توزيع العناصر بشكل متساوٍ أو غير متساوٍ بصرياً',
        'ج. كثرة التفاصيل',
        'د. استخدام لون واحد'
      ],
      correctOption: 'ب. توزيع العناصر بشكل متساوٍ أو غير متساوٍ بصرياً'
    },
    {
      id: 14,
      text: 'التباين في التصميم يُستخدم من أجل:',
      options: [
        'أ. إخفاء العناصر',
        'ب. تحقيق التشابه',
        'ج. إبراز العناصر المهمة',
        'د. تقليل التأثير البصري'
      ],
      correctOption: 'ج. إبراز العناصر المهمة'
    },
    {
      id: 15,
      text: 'الوحدة في التصميم تعني:',
      options: [
        'أ. استخدام عنصر واحد',
        'ب. عدم وجود تنوع',
        'ج. ترابط عناصر التصميم في تكوين متكامل',
        'د. تكرار اللون فقط'
      ],
      correctOption: 'ج. ترابط عناصر التصميم في تكوين متكامل'
    },
    {
      id: 16,
      text: 'التصميم الرقمي يعتمد أساساً على:',
      options: [
        'أ. الخامات الطبيعية',
        'ب. الأدوات اليدوية',
        'ج. البرمجيات والتقنيات الرقمية',
        'د. الرسم بالقلم فقط'
      ],
      correctOption: 'ج. البرمجيات والتقنيات الرقمية'
    },
    {
      id: 17,
      text: 'من عناصر التصميم الرقمي:',
      options: [
        'أ. النقطة اليدوية',
        'ب. الخط التقليدي',
        'ج. الحركة الرقمية',
        'د. الورق المقوى'
      ],
      correctOption: 'ج. الحركة الرقمية'
    },
    {
      id: 18,
      text: 'يتيح المعمل الافتراضي للطالب:',
      options: [
        'أ. التلقي السلبي فقط',
        'ب. التفاعل والمحاكاة الرقمية',
        'ج. حفظ المعلومات دون تطبيق',
        'د. إلغاء دور التصميم الفني'
      ],
      correctOption: 'ب. التفاعل والمحاكاة الرقمية'
    },
    {
      id: 19,
      text: 'من عناصر التصميم (تكملة):',
      options: [
        'أ) التظليل',
        'ب) التدرج',
        'ج) النقطة',
        'د) التبشير'
      ],
      correctOption: 'ج) النقطة'
    },
    {
      id: 20,
      text: 'يُقصد بأسس التصميم:',
      options: [
        'أ. الأدوات المستخدمة في الرسم',
        'ب. القواعد التي تنظم العلاقات بين عناصر التصميم',
        'ج. أنواع الخطوط فقط',
        'د. الأشكال الهندسية الجاهزة'
      ],
      correctOption: 'ب. القواعد التي تنظم العلاقات بين عناصر التصميم'
    },
    {
      id: 21,
      text: 'من الألوان الحيادية التي يمكن استخدامها داخل برامج التصميم الرقمي:',
      options: [
        'أ) البنفسجي',
        'ب) الأحمر',
        'ج) الأزرق',
        'د) الأبيض'
      ],
      correctOption: 'د) الأبيض'
    },
    {
      id: 22,
      text: 'من أسس التصميم التي يُراعى تطبيقها عند بناء تصميم رقمي داخل المعمل الافتراضي:',
      options: [
        'أ) الإيقاع',
        'ب) التناسب',
        'ج) الاتزان',
        'د) كل ما سبق'
      ],
      correctOption: 'د) كل ما سبق'
    },
    {
      id: 23,
      text: 'التناسب في التصميم الرقمي داخل المعمل الافتراضي يعني:',
      options: [
        'أ) العلاقة القياسية المصممة فقط',
        'ب) مقارنة الأحجام والمساحات والأطوال داخل مساحة العمل الرقمية',
        'ج) النسبة المخططة للمقادير والفواصل فقط',
        'د) (أ، ج) صحيحتان'
      ],
      correctOption: 'ب) مقارنة الأحجام والمساحات والأطوال داخل مساحة العمل الرقمية'
    },
    {
      id: 24,
      text: 'قاعدة المتوالية العددية في التصميم (٣٤ - ٥٥ - ٨٩ - ١٤٤) يمكن توظيفها داخل التصميمات الرقمية وفق:',
      options: [
        'أ) النسبة الذهبية',
        'ب) النسبة التوافقية',
        'ج) النسبة العشوائية',
        'د) النسبة المئوية'
      ],
      correctOption: 'أ) النسبة الذهبية'
    },
    {
      id: 25,
      text: 'النسبة الذهبية في التصميم الافتراضي تعني:',
      options: [
        'أ) مساحة الشكل ومحيطه',
        'ب) جزئين من عرض مضروب في الطول',
        'ج) جزئين من الطول بحيث تتكرر النسبة بين الجزء والكل داخل التكوين الرقمي',
        'د) جزئين من المساحة فقط'
      ],
      correctOption: 'ج) جزئين من الطول بحيث تتكرر النسبة بين الجزء والكل داخل التكوين الرقمي'
    },
    {
      id: 26,
      text: 'الألوان الأساسية التي تستخدم في التصميم الرقمي هي:',
      options: [
        'أ) بني - أزرق - أسود',
        'ب) بنفسجي - أخضر - برتقالي',
        'ج) أحمر - أصفر - أزرق',
        'د) أصفر - رمادي - بيج'
      ],
      correctOption: 'ج) أحمر - أصفر - أزرق'
    },
    {
      id: 27,
      text: 'الألوان التي تنتج من خلط لونين أساسيين تسمى:',
      options: [
        'أ) الألوان الأساسية',
        'ب) الألوان الثانوية',
        'ج) الألوان الأحادية',
        'د) الألوان الحيادية'
      ],
      correctOption: 'ب) الألوان الثانوية'
    },
    {
      id: 28,
      text: 'يستفاد من القيمة الضوئية للون في:',
      options: [
        'أ) التمييز بين درجة إشراق اللون وبريقه',
        'ب) التحكم في قوة اللون وصفائه عبر أدوات البرنامج',
        'ج) ضبط الإضاءة الافتراضية للتصميم',
        'د) كل ما سبق'
      ],
      correctOption: 'د) كل ما سبق'
    },
    {
      id: 29,
      text: 'أطول الألوان طولاً موجياً وأكثرها قدرة على الجذب بصرياً في التصميمات الرقمية هو:',
      options: [
        'أ) الأخضر',
        'ب) الأصفر',
        'ج) الأحمر',
        'د) الأزرق'
      ],
      correctOption: 'ج) الأحمر'
    },
    {
      id: 30,
      text: 'التكرار (١-٢-١-٢-١) في التصميم يُعد تكراراً:',
      options: [
        'أ) رتيباً',
        'ب) منتظماً',
        'ج) متناوباً',
        'د) عشوائياً'
      ],
      correctOption: 'ج) متناوباً'
    },
    {
      id: 31,
      text: 'يقسم دليل القيمة الضوئية المستخدم في ضبط الألوان داخل بيئات التصميم الرقمي إلى:',
      options: [
        'أ) ثلاث درجات',
        'ب) ست درجات',
        'ج) تسع درجات',
        'د) اثنتي عشرة درجة'
      ],
      correctOption: 'ب) ست درجات'
    },
    {
      id: 32,
      text: 'تتحلل الضوء الأبيض عند محاكاته إلى:',
      options: [
        'أ) ثلاثة ألوان',
        'ب) خمسة ألوان',
        'ج) سبعة ألوان',
        'د) تسعة ألوان'
      ],
      correctOption: 'ج) سبعة ألوان'
    },
    {
      id: 33,
      text: 'التكرار الكامل للعناصر المتماثلة داخل التصميم الرقمي يسمى:',
      options: [
        'أ) تناغم',
        'ب) تنافر',
        'ج) تشابه',
        'د) تماثل'
      ],
      correctOption: 'د) تماثل'
    },
    {
      id: 34,
      text: 'التشابه في العمل الفني الرقمي يعني:',
      options: [
        'أ) وجود وحدات مشتركة في أكثر من عنصر أو صفة داخل التصميم',
        'ب) وجود وحدات مشتركة في جميع العناصر',
        'ج) عدم وجود وحدات مشتركة',
        'د) كل ما سبق خطأ'
      ],
      correctOption: 'أ) وجود وحدات مشتركة في أكثر من عنصر أو صفة داخل التصميم'
    },
    {
      id: 35,
      text: 'التوازن في التكوين الرقمي هو:',
      options: [
        'أ) تعادل القوى المتعاكسة داخل مساحة التصميم',
        'ب) تغير القوى المتعاكسة',
        'ج) تطابق القوى المتعاكسة',
        'د) تشابه القوى المتعاكسة'
      ],
      correctOption: 'أ) تعادل القوى المتعاكسة داخل مساحة التصميم'
    },
    {
      id: 36,
      text: 'التوازن الذي يكون أقل هدوءاً وأكثر جذباً للاهتمام في التصميم الرقمي هو:',
      options: [
        'أ) التوازن الشكلي',
        'ب) التوازن اللاشكلي',
        'ج) التوازن المتطابق',
        'د) التوازن المتشابه'
      ],
      correctOption: 'ب) التوازن اللاشكلي'
    },
    {
      id: 37,
      text: 'شدة اللون في بيئة المعمل الافتراضي تعني:',
      options: [
        'أ) مقدار زهوة اللون ونقائه',
        'ب) كون اللون فاتحاً أو غامقاً',
        'ج) التأثير النفسي للون',
        'د) إدراك العين للون'
      ],
      correctOption: 'أ) مقدار زهوة اللون ونقائه'
    },
    {
      id: 38,
      text: 'يمزج الألوان الأساسية ضوئياً داخل برامج التصميم ينتج اللون:',
      options: [
        'أ) الأخضر',
        'ب) البنفسجي',
        'ج) الأبيض',
        'د) البني'
      ],
      correctOption: 'ج) الأبيض'
    },
    {
      id: 39,
      text: 'من متقابلات التصميم:',
      options: [
        'أ) اللون والملمس',
        'ب) التدرج والتنوع',
        'ج) الزمان والمكان',
        'د) السيادة والحركة'
      ],
      correctOption: 'ج) الزمان والمكان'
    },
    {
      id: 40,
      text: 'يتوقف إدراك الأشكال المجسمة بعدة عوامل منها:',
      options: [
        'أ) اختلاف الوظيفة',
        'ب) اختلاف تأثير مادة الشكل',
        'ج) اختلاف تركيب المساحات',
        'د) كل ما سبق'
      ],
      correctOption: 'د) كل ما سبق'
    }
  ]);

  currentPage = signal<number>(0);

  // Pagination ranges (Same as Judging)
  pageRanges = [
    { start: 0, end: 8 },
    { start: 8, end: 17 },
    { start: 17, end: 23 },
    { start: 23, end: 29 },
    { start: 29, end: 35 },
    { start: 35, end: 40 }
  ];

  get visibleQuestions() {
    const range = this.pageRanges[this.currentPage()];
    return this.questions().slice(range.start, range.end);
  }

  get totalPages() {
    return this.pageRanges.length;
  }

  nextPage() {
    if (this.currentPage() < this.totalPages - 1) {
      this.currentPage.update(p => p + 1);
      window.scrollTo(0, 0);
    }
  }

  prevPage() {
    if (this.currentPage() > 0) {
      this.currentPage.update(p => p - 1);
      window.scrollTo(0, 0);
    }
  }

  startExam() {
    this.step.set('exam');
    window.scrollTo(0, 0);
  }

  submitExam() {
    // Calculate Score
    let correctCount = 0;
    this.questions().forEach(q => {
      // Logic to check answer needs to allow flexibility since 'selectedOption' might be just the text
      if (q.selectedOption === q.correctOption) {
        correctCount++;
      }
    });

    this.score.set(correctCount);
    this.totalQuestions.set(this.questions().length);

    this.step.set('result');
    window.scrollTo(0, 0);
  }
}
