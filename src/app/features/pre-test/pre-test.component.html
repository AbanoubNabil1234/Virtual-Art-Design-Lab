<div class="max-w-4xl mx-auto p-4 md:p-8">

    <!-- STEP 1: INTRO / INSTRUCTIONS -->
    <div *ngIf="step() === 'intro'"
        class="bg-gray-50 border border-gray-200 rounded-xl p-6 md:p-10 shadow-sm animate-fade-in-up">
        <div class="text-center mb-8">
            <h2 class="text-3xl font-extrabold text-gray-900 mb-2">اختبار(أ)</h2>
            <h3 class="text-lg text-gray-600 font-semibold">الجانب المعرفي في مهارات التصميم للطلاب المرحلة الثانوية
            </h3>
        </div>

        <div class="space-y-6 text-right leading-relaxed text-gray-800">
            <div>
                <p class="font-bold text-secondary border-r-4 border-secondary pr-3 mb-2">هدف الاختبار:</p>
                <p>يهدف الاختبار التحصيلي إلى قياس مدى تمكن طلاب المرحلة الثانوية من مفاهيم التصميم في مادة التربية
                    الفنية، وذلك في ضوء استخدام المعمل الافتراضي، والتعرّف على مستوى التحصيل المعرفي لديهم.</p>
            </div>

            <div>
                <p class="font-bold text-secondary border-r-4 border-secondary pr-3 mb-2">تعليمات الاختبار التحصيلي:</p>
                <p>عزيزي الطالب / عزيزتي الطالبة يرجى قراءة التعليمات التالية بعناية قبل البدء في الإجابة:</p>
                <ul class="list-decimal list-inside pr-2 space-y-2 mt-2">
                    <li>يتكون هذا الاختبار من مجموعة من الأسئلة التي تقيس مفاهيم التصميم.</li>
                    <li>يرجى اختيار الإجابة الصحيحة من بين البدائل الأربعة.</li>
                    <li>لا تترك أي سؤال دون إجابة.</li>
                    <li>الإجابة تكون في المكان المخصص لها فقط.</li>
                </ul>
            </div>
        </div>

        <div class="mt-10 pt-8 border-t border-gray-200 text-center">
            <h3 class="text-xl font-bold text-gray-700 mb-4">مع تمنياتنا لك بالتوفيق</h3>
            <div class="flex flex-col items-center">
                <p class="text-sm text-gray-500 mb-1">إعــداد الباحث</p>
                <p class="text-lg font-bold text-gray-900">أحمد عدنان ياسين</p>
            </div>
            <button (click)="startExam()" class="btn-action mt-8">ابدأ الاختبار</button>
        </div>
    </div>

    <!-- STEP 2: EXAM QUESTIONS -->
    <div *ngIf="step() === 'exam'" class="animate-fade-in">
        <div class="bg-white border-2 border-primary/20 rounded-lg p-4 mb-6 shadow-sm">
            <h2 class="text-xl font-bold text-gray-900 text-center">أسئلة الاختبار: اختر الإجابة الصحيحة مما يلي:</h2>
        </div>

        <div class="space-y-6">
            <div *ngFor="let q of visibleQuestions" class="question-card">
                <div class="flex gap-4 items-start mb-6">
                    <span
                        class="bg-primary text-white w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0 font-bold">
                        {{q.id}}
                    </span>
                    <div class="text-lg font-bold text-gray-900 leading-tight pt-1">
                        {{q.text}}
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                    <label *ngFor="let opt of q.options; let i = index" class="option-row"
                        [class.bg-primary-50]="q.selectedOption === opt"
                        [class.border-primary-200]="q.selectedOption === opt">
                        <input type="radio" [name]="'q' + q.id" [value]="opt" [(ngModel)]="q.selectedOption"
                            class="w-5 h-5 accent-primary cursor-pointer">
                        <span class="text-gray-800 text-base">{{opt}}</span>
                    </label>
                </div>
            </div>
        </div>

        <!-- Pagination Controls -->
        <div class="flex justify-between items-center mt-10 py-6 border-t border-gray-100">
            <button [disabled]="currentPage() === 0" (click)="prevPage()"
                class="btn-primary bg-gray-500 hover:bg-gray-600 disabled:opacity-30 px-6 py-2">
                السابق
            </button>

            <span class="font-bold text-gray-600 text-lg">
                صفحة {{currentPage() + 1}} من {{totalPages}}
            </span>

            <button *ngIf="currentPage() < totalPages - 1" (click)="nextPage()" class="btn-primary px-6 py-2">
                التالي
            </button>

            <button *ngIf="currentPage() === totalPages - 1" (click)="submitExam()"
                class="btn-primary bg-green-600 hover:bg-green-700 px-6 py-2">
                تسليم الإجابة
            </button>
        </div>
    </div>

    <!-- STEP 3: RESULT -->
    <div *ngIf="step() === 'result'"
        class="bg-white border border-gray-100 rounded-2xl p-10 shadow-xl text-center animate-scale-in">
        <span class="material-icons text-7xl text-green-500 mb-4">check_circle</span>
        <h2 class="text-3xl font-extrabold text-green-600 mb-2">تم تسليم الاختبار بنجاح</h2>
        <p class="text-lg text-gray-600 mb-8">شكراً لك على إتمام الاختبار التحصيلي.</p>

        <div class="score-display">
            النتيجة: {{score()}} / {{totalQuestions()}}
        </div>

        <p class="text-gray-500 mt-4">تم تسجيل إجاباتك بنجاح في النظام.</p>

        <button (click)="step.set('intro')" class="btn-primary bg-gray-600 mt-10">
            عودة للصفحة الرئيسية للاختبار
        </button>
    </div>

</div>